var APromise=function(){var t="FULFILED",n="REJECTED",e="PENDING";function r(t){return"function"==typeof t}function c(t,n,e,u){if(t===n)return u(new TypeError("循环引用!"));var o;function i(){if(!o)return o=!0,e(n)}function a(t){o||(o=!0,u(t))}if(n&&(r(n)||"object"==typeof n))try{var f=n.then;r(f)?f.call(n,function(n){o||(o=!0,c(t,n,e,u))},a):i()}catch(t){a(t)}else i()}return function(){function u(r){this.status=e,this.resolvedCallbacks=[],this.rejectedCallbacks=[];var c=this;function u(t){setTimeout(function(){c.status===e&&(c.reason=t,c.status=n,c.rejectedCallbacks.forEach(function(t){return t()}))})}try{r(function(n){setTimeout(function(){c.status===e&&(c.value=n,c.status=t,c.resolvedCallbacks.forEach(function(t){return t()}))})},u)}catch(t){u(t)}}return u.prototype.then=function(o,i){var a,f=this;return o=r(o)?o:function(t){return t},i=r(i)?i:function(t){throw t},f.status===e?a=new u(function(t,n){f.resolvedCallbacks.push(function(){try{var e=o(f.value);c(a,e,t,n)}catch(t){n(t)}}),f.rejectedCallbacks.push(function(){try{var e=i(f.reason);c(a,e,t,n)}catch(t){n(t)}})}):f.status===t?a=new u(function(t,n){setTimeout(function(){try{var e=o(f.value);c(a,e,t,n)}catch(t){n(t)}})}):f.status===n?a=new u(function(t,n){setTimeout(function(){try{var e=i(f.reason);c(a,e,t,n)}catch(t){n(t)}})}):void 0},u.prototype.done=function(t){return this.then(t)},u.prototype.catch=function(t){return this.then(null,t)},u.prototype.fail=function(t){return this.then(null,t)},u.deferred=function(){var t={};return t.promise=new u(function(n,e){t.resolve=n,t.reject=e}),t},u.resolve=function(t){return new u(function(n,e){n(t)})},u.reject=function(t){return new u(function(n,e){e(t)})},u.all=function(t){return new u(function(n,e){var r=[],c=t.length;function o(t,e){r[e]=t,--c<=0&&n(r)}t.forEach(function(t,n){t.then&&t instanceof u?t.then(function(t){o(t,n)},e):o(t,n)})})},u.race=function(t){return new u(function(n,e){t.forEach(function(t,r){if(t instanceof u&&t.then)t.then(n,e);else try{n(t)}catch(t){e(t)}})})},u}()}();